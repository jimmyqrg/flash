<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Follow Mouse Popup</title>
</head>
<body>

<script>
let popup;
let shouldOpenNewPopups = true;

// Open the popup
function openFollowPopup() {
    if (!shouldOpenNewPopups) return;
    
    popup = window.open('', 'popup', 'width=250,height=120,menubar=no,toolbar=no,status=no,resizable=no');
    
    if (!popup || popup.closed) return;
    
    popup.document.write(`
        <html>
        <head>
            <title>Popup</title>
        </head>
        <body style="margin:0;display:flex;align-items:center;justify-content:center;background:#ffb6c1;cursor:default;">
            <div id="content" style="font-family:sans-serif;font-size:14px;color:white;text-align:center;padding:10px;">
                Press Ctrl+Shift+P to stop the whole thing.
            </div>
        </body>
        </html>
    `);
    
    // Prevent clicking from closing
    popup.document.body.onclick = (e) => {
        e.preventDefault();
        e.stopPropagation();
        return false;
    };
    
    // Track popup close event to reopen if needed
    const checkPopupClosed = setInterval(() => {
        if (popup.closed) {
            clearInterval(checkPopupClosed);
            if (shouldOpenNewPopups) {
                // Popup was closed (likely by Ctrl+W), reopen it
                setTimeout(openFollowPopup, 100);
            }
        }
    }, 100);
}

// Track mouse and move popup
document.addEventListener('mousemove', (e) => {
    if(popup && !popup.closed){
        // Move the popup window to mouse position
        // Adjust by half popup size so the cursor is centered
        let x = e.screenX - 125; // 250 width / 2
        let y = e.screenY - 60;  // 120 height / 2
        popup.moveTo(x, y);
    }
});

// Global keyboard shortcut handler
document.addEventListener('keydown', (e) => {
    // Ctrl+Shift+P to stop everything
    if (e.ctrlKey && e.shiftKey && e.key === 'P') {
        e.preventDefault();
        
        // Close the popup if it exists
        if (popup && !popup.closed) {
            popup.close();
        }
        
        // Prevent any new popups from opening
        shouldOpenNewPopups = false;
    }
});

// Add keyboard listener to popup window when it opens
const originalOpenFollowPopup = openFollowPopup;
openFollowPopup = function() {
    originalOpenFollowPopup();
    
    // Set up a check to add event listener to popup
    const tryAddListener = setInterval(() => {
        if (popup && !popup.closed && popup.document) {
            try {
                // Add keyboard event listener to popup window
                popup.document.addEventListener('keydown', (e) => {
                    // Ctrl+Shift+P to stop everything
                    if (e.ctrlKey && e.shiftKey && e.key === 'P') {
                        e.preventDefault();
                        
                        // Close the popup
                        popup.close();
                        
                        // Prevent any new popups from opening
                        shouldOpenNewPopups = false;
                    }
                });
                
                // Focus the popup window
                popup.focus();
                clearInterval(tryAddListener);
            } catch (e) {
                // Cross-origin restriction, ignore
            }
        }
    }, 50);
};

// Open popup on load
window.onload = openFollowPopup;

// Also reopen popup if current window is closed
window.onbeforeunload = () => {
    if (shouldOpenNewPopups && popup && !popup.closed) {
        // This will trigger the popup to reopen itself
        popup.close();
    }
};
</script>

</body>
</html>
